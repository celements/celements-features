#set($xwikiAllGroupDoc = $services.modelAccess.getDocument($services.reference.resolveDocRef("XWiki.XWikiAllGroup")))
#set($groupsDocRefList = $services.group.getAllLocalGroups())
#set($dev = $groupsDocRefList.remove($xwikiAllGroupDoc))
#foreach($groupDocRef in $groupsDocRefList)
  #set($groupDoc = $services.modelAccess.getDocument($groupDocRef))
  #set($prettyName = $services.group.getGroupPrettyName($groupDocRef))
  #set($objNb = $groupDoc.getObject('XWiki.XWikiGroups', 'member', "$doc").number)
  #set($isMember = 1)
  #if (!$objNb)
    #set($objNb = $groupDoc.getObject('XWiki.XWikiGroups', 'member', '').number)
    #set($isMember = 0)
  #end
  #if (!$objNb)
    #set($objNb = -1)
  #end
  <div class='checkboxWrapper'>
    #set($inputName = "$!{services.reference.serialize($groupDocRef, 
  'local')}_XWiki.XWikiGroups_$!{objNb}_member")
    <input type='checkbox' value='$!{services.reference.serialize($doc.documentReference)}' 
   name='$!{inputName}' #if($isMember == 1)  checked #end>
    <input type='hidden' value='' name='$!{inputName}'>
    <label for='$!{inputName}'>$!prettyName</label>
  </div>
#end
